<!DOCTYPE html>
<html>
<head>
    <title>Trip Visualization</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.1.0/leaflet.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.1.0/leaflet.js"></script>
    <style> 
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        body {
            font-family: Roboto, helvetica, arial, sans-serif;
            text-align: center;
            /*font-weight: lighter;*/
            font-size: 60px;

            display: flex;
        }

        #header {
            position: absolute;
            padding-right: 15px;
            right: 0;
            z-index: 500;
            opacity: 0.75;
            color: #37474F;

            pointer-events: none;
        }

        #dates {
            font-size: 27px;
            display: block;
            font-weight: lighter;
        }

        iframe {
            border: 0;
            width: 100%;
            height: 100%;
        }

        #map {
            border: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="title">Japan Trip</div>
        <span id="dates"></span>
    </div>
    <div id="map"></div>
    <script type="text/javascript">
        const toDateStr = d => `${d.getMonth() + 1}/${d.getDate()}/${d.getFullYear()}`

        const map = L.map('map')

        // use CartoDB-light-nolabels from 
        // https://leaflet-extras.github.io/leaflet-providers/preview/
        L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            maxZoom: 19
        }).addTo(map)

        fetch('example.json')
            .then(res => res.json())
            .then(json => {

                const latlon = json.map(data => {
                    const lat = data.lat
                    const lon = data.lon

                    return new L.LatLng(lat, lon)
                })

                new L.Polyline(latlon, {
                    color: '#E91E63',
                    weight: 1,
                    opacity: 1,
                    smoothFactor: 1
                }).addTo(map)

                latlon.forEach(pt => {
                    new L.Circle(pt, {
                        color: '#E91E63',
                        fillOpacity: 1,
                        smoothFactor: 1,
                        radius: 4,
                        weight: 0
                    }).addTo(map)
                })

                map.fitBounds(new L.LatLngBounds(latlon))

                // Generate dates to display
                let minDate = null
                let maxDate = null
                json.forEach(data => {
                    data.date = new Date(data.date)

                    console.log(data.filename, data.date)

                    if (!minDate || data.date < minDate) minDate = data.date
                    if (!maxDate || data.date > maxDate) maxDate = data.date
                })

                const dateel = document.querySelector('#dates')
                const str = toDateStr(minDate) + ' to ' + toDateStr(maxDate)
                dateel.innerHTML = str
            })
    </script>
</body>
</html>